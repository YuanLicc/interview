## 数据结构

Redis 支持的键值类型包含：

- 字符串 String  
- 散列 Hash
- 列表 List
- 集合 Set
- 有序集合 SortedSet  

Redis 将所有数据都存储在内存中，所以比基于硬盘存储的数据库快，但数据存储在内存中会在程序退出时导致数据丢失，因此 Redis 还提供了数据持久化的支持。

##### 顶层 KV 数据结构（全局哈希表）  
哈希桶 + 链表

##### rehash  
伴随着哈希冲突的增多，必然需要更大的哈希桶来进行一个 rehash 过程，减少哈希冲突。

- 结构  全局哈希表1（正在使用）、全局哈希表2（更大空间）

目标是将全局哈希表1 内内容重新计算 哈希并复制到 全局哈希表2中，大量的数据拷贝将会造成线程阻塞，为了解决这个问题，采用分治的思想进行数据拷贝 - 渐进式rehash
将数据拷贝分到后续的每一次请求上，处理请求时，顺带的从哈希表头部开始，每一次拷贝一部分数据

##### 底层数据结构

简单动态字符串、双向链表(doublelist, O(n))、压缩列表(ziplist, O(n))、哈希表(hashtable, O(1))、整数数组(intset, O(n))、跳表(skiplist, O(logn))

- String -> 简单动态字符串  
- List -> 双向链表、压缩列表  
- Hash -> 压缩列表、哈希表  
- Set -> 哈希表、整数数组  
- SortedSet -> 压缩列表、跳表  

1)压缩列表  

zlbytes(列表字节数) + zltail(列表尾部偏移量) + zllen(列表元素个数) + 元素（zllen） + zlend(列表结束)

2)跳表  
链表的访问只能顺序访问，在链表的基础上增加索引，可以通过索引减少查找次数。  
![skiplist](./images/skiplist.jpg)  

